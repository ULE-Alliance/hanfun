<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>HAN-FUN API: Alert interface usage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ule-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HAN-FUN API
   &#160;<span id="projectnumber">1.5.1</span>
   </div>
   <div id="projectbrief">This project provides the common implementation of ULE Alliance&#39;s HAN-FUN application protocol.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('example_03.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Alert interface usage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This example demonstrates the usage of Alert interface API.</p>
<p>We again create two nodes, one will contain a unit that will generate Alert events (the server) and the other will have a unit that receives those events (the client).</p>
<p>The above units are created by extending the <a class="el" href="classHF_1_1Units_1_1Unit.html" title="Helper template class to implement units. ">HF::Units::Unit</a> with the correct profile.</p>
<p>For the server side we can use the <a class="el" href="classHF_1_1Profiles_1_1SimpleDetector.html" title="Simple Detector profile implementation. ">HF::Profiles::SimpleDetector</a> profile.</p>
<p><div class="fragment"><div class="line">   <span class="keyword">struct </span>SimpleDetector: <span class="keyword">public</span> <a class="code" href="classHF_1_1Units_1_1Unit.html">HF::Units::Unit</a>&lt;HF::Profiles::SimpleDetector&gt;</div><div class="line">   {</div><div class="line">      SimpleDetector(uint8_t <span class="keywordtype">id</span>, <a class="code" href="structHF_1_1IDevice.html">HF::IDevice</a> &amp;device):</div><div class="line">         <a class="code" href="namespaceHF.html">HF</a>::Units::Unit&lt;<a class="code" href="namespaceHF.html">HF</a>::Profiles::SimpleDetector&gt;(id, device)</div><div class="line">      {}</div><div class="line">   };</div></div><!-- fragment --></p>
<p>For the client side the <a class="el" href="classHF_1_1Profiles_1_1Alertable.html" title="Alertable profile implementation. ">HF::Profiles::Alertable</a> profile.</p>
<p><div class="fragment"><div class="line">   <span class="keyword">struct </span>AlertSink: <span class="keyword">public</span> <a class="code" href="classHF_1_1Units_1_1Unit.html">HF::Units::Unit</a>&lt;HF::Profiles::Alertable&gt;</div><div class="line">   {</div><div class="line">      AlertSink(uint8_t <span class="keywordtype">id</span>, <a class="code" href="structHF_1_1IDevice.html">HF::IDevice</a> &amp;device):</div><div class="line">         <a class="code" href="namespaceHF.html">HF</a>::Units::Unit&lt;<a class="code" href="namespaceHF.html">HF</a>::Profiles::Alertable&gt;(id, device)</div><div class="line">      {}</div><div class="line"></div><div class="line">      <span class="keywordtype">void</span> status(<a class="code" href="structHF_1_1Protocol_1_1Address.html">HF::Protocol::Address</a> &amp;source, <a class="code" href="structHF_1_1Interfaces_1_1Alert_1_1Message.html">HF::Interfaces::Alert::Message</a> &amp;message)</div><div class="line">      {</div><div class="line">         <a class="code" href="classHF_1_1Units_1_1Unit.html">HF::Units::Unit&lt;HF::Profiles::Alertable&gt;::status</a>(source, message);</div><div class="line"></div><div class="line">         <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Alert received &quot;</span> &lt;&lt; std::hex &lt;&lt; std::showbase</div><div class="line">                   &lt;&lt; message.<a class="code" href="structHF_1_1Interfaces_1_1Alert_1_1Message.html#a5bc365bdb1cf890c31d53b2e6a36c44f">state</a> &lt;&lt; <span class="stringliteral">&quot; !&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">      }</div><div class="line">   };</div></div><!-- fragment --></p>
<p>Then the unit for each device must be declared. Node 1 will have the server side unit and node 2 the client side unit.</p>
<p><div class="fragment"><div class="line">   Node node1;</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Add unit to node1 instance ...&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   SimpleDetector simple_detector(1, node1);</div><div class="line"></div><div class="line">   Node node2;</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Add unit to node2 instance ...&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   AlertSink alert_sink(1, node2);</div></div><!-- fragment --></p>
<p>With this in place and after the devices are connected and registered node 1 can send alert events to node 2.</p>
 <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="hanfun_8h.html">hanfun.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="debug_8h.html">hanfun/debug.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="localloop_8h.html">localloop.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// =============================================================================</span></div><div class="line"><span class="comment">// Implementation</span></div><div class="line"><span class="comment">// =============================================================================</span></div><div class="line"></div><div class="line"><span class="keyword">namespace</span></div><div class="line">{</div><div class="line">   <span class="comment">/*</span></div><div class="line"><span class="comment">    * Unit implementing the Simple Detector profile.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">struct </span>SimpleDetector: <span class="keyword">public</span> <a class="code" href="classHF_1_1Units_1_1Unit.html">HF::Units::Unit</a>&lt;HF::Profiles::SimpleDetector&gt;</div><div class="line">   {</div><div class="line">      SimpleDetector(uint8_t <span class="keywordtype">id</span>, <a class="code" href="structHF_1_1IDevice.html">HF::IDevice</a> &amp;device):</div><div class="line">         <a class="code" href="namespaceHF.html">HF</a>::Units::Unit&lt;<a class="code" href="namespaceHF.html">HF</a>::Profiles::SimpleDetector&gt;(id, device)</div><div class="line">      {}</div><div class="line">   };</div><div class="line"></div><div class="line">   <span class="comment">/*</span></div><div class="line"><span class="comment">    * Unit implementing the Alertable profile, to receive alert events.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">struct </span>AlertSink: <span class="keyword">public</span> <a class="code" href="classHF_1_1Units_1_1Unit.html">HF::Units::Unit</a>&lt;HF::Profiles::Alertable&gt;</div><div class="line">   {</div><div class="line">      AlertSink(uint8_t <span class="keywordtype">id</span>, <a class="code" href="structHF_1_1IDevice.html">HF::IDevice</a> &amp;device):</div><div class="line">         <a class="code" href="namespaceHF.html">HF</a>::Units::Unit&lt;<a class="code" href="namespaceHF.html">HF</a>::Profiles::Alertable&gt;(id, device)</div><div class="line">      {}</div><div class="line"></div><div class="line">      <span class="keywordtype">void</span> status(<a class="code" href="structHF_1_1Protocol_1_1Address.html">HF::Protocol::Address</a> &amp;source, <a class="code" href="structHF_1_1Interfaces_1_1Alert_1_1Message.html">HF::Interfaces::Alert::Message</a> &amp;message)</div><div class="line">      {</div><div class="line">         <a class="code" href="classHF_1_1Units_1_1Unit.html">HF::Units::Unit&lt;HF::Profiles::Alertable&gt;::status</a>(source, message);</div><div class="line"></div><div class="line">         <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Alert received &quot;</span> &lt;&lt; std::hex &lt;&lt; std::showbase</div><div class="line">                   &lt;&lt; message.<a class="code" href="structHF_1_1Interfaces_1_1Alert_1_1Message.html#a5bc365bdb1cf890c31d53b2e6a36c44f">state</a> &lt;&lt; <span class="stringliteral">&quot; !&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">      }</div><div class="line">   };</div><div class="line"></div><div class="line">   <span class="comment">/*</span></div><div class="line"><span class="comment">    * Example node.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">struct </span>Node: <span class="keyword">public</span> <a class="code" href="classHF_1_1Devices_1_1Node_1_1Abstract.html">HF::Devices::Node::Node</a></div><div class="line">   {};</div><div class="line"></div><div class="line">   <span class="comment">/*</span></div><div class="line"><span class="comment">    * Example concentrator.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">struct </span><a class="code" href="structBase.html">Base</a>: <span class="keyword">public</span> <a class="code" href="classHF_1_1Devices_1_1Concentrator_1_1Abstract.html">HF::Devices::Concentrator::Concentrator</a></div><div class="line">   {};</div><div class="line"></div><div class="line">}  <span class="comment">// namespace</span></div><div class="line"></div><div class="line"><span class="comment">// =============================================================================</span></div><div class="line"><span class="comment">// MAIN</span></div><div class="line"><span class="comment">// =============================================================================</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div><div class="line">{</div><div class="line">   <a class="code" href="group__common.html#ga86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(argc);</div><div class="line">   <a class="code" href="group__common.html#ga86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(argv);</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Use case : Alert interface usage&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line"></div><div class="line">   <span class="comment">/*</span></div><div class="line"><span class="comment">    * Each node variable is a remote device, i.e.,</span></div><div class="line"><span class="comment">    * the Node variables are declared on the remote device</span></div><div class="line"><span class="comment">    * code and are not used on the base code.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Create the node instances ...&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line"></div><div class="line">   Node node1;</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Add unit to node1 instance ...&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   SimpleDetector simple_detector(1, node1);</div><div class="line"></div><div class="line">   Node node2;</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Add unit to node2 instance ...&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   AlertSink alert_sink(1, node2);</div><div class="line"></div><div class="line">   <span class="comment">/*</span></div><div class="line"><span class="comment">    * This instance represents the base application.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Create the base instance ...&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   <a class="code" href="structBase.html">Base</a> base;</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Create transport instance&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   Localloop loop;</div><div class="line"></div><div class="line">   <span class="comment">/*</span></div><div class="line"><span class="comment">    * Setup the network.</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * This simulates the devices connecting to the base using for</span></div><div class="line"><span class="comment">    * example a TCP/IP connection or a DECT ULE PVC.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Network setup ...&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line"></div><div class="line">   loop.set_base(&amp;base);</div><div class="line">   loop.add_node(&amp;node1, <span class="stringliteral">&quot;node_1&quot;</span>);</div><div class="line">   loop.add_node(&amp;node2, <span class="stringliteral">&quot;node_2&quot;</span>);</div><div class="line"></div><div class="line">   <span class="comment">// Register the two devices.</span></div><div class="line"></div><div class="line">   <span class="comment">// Node 1 is unregistered.</span></div><div class="line">   assert(node1.address() == <a class="code" href="group__protocol.html#ga23f7a5fde66435071c5d332e9d3dbf0f">HF::Protocol::BROADCAST_ADDR</a>);</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Registering node1 ... &quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   node1.unit0()-&gt;device_management()-&gt;register_device();</div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Node1 address ... &quot;</span> &lt;&lt; node1.address() &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line"></div><div class="line">   <span class="comment">// Node 1 is registered</span></div><div class="line">   assert(node1.address() == 1);</div><div class="line"></div><div class="line">   <span class="comment">// Node 2 is unregistered.</span></div><div class="line">   assert(node2.address() == <a class="code" href="group__protocol.html#ga23f7a5fde66435071c5d332e9d3dbf0f">HF::Protocol::BROADCAST_ADDR</a>);</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Registering node2 ... &quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   node2.unit0()-&gt;device_management()-&gt;register_device();</div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Node2 address ... &quot;</span> &lt;&lt; node2.address() &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line"></div><div class="line">   <span class="comment">// Node 2 is registered</span></div><div class="line">   assert(node2.address() == 2);</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;There should be two registered devices ... &quot;</span></div><div class="line">             &lt;&lt; base.<a class="code" href="classHF_1_1Devices_1_1Concentrator_1_1Abstract.html#a2cb2098ad66f441fe4c9eb6a376007af">unit0</a>()-&gt;device_management()-&gt;entries().size() &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line"></div><div class="line">   assert(base.<a class="code" href="classHF_1_1Devices_1_1Concentrator_1_1Abstract.html#a2cb2098ad66f441fe4c9eb6a376007af">unit0</a>()-&gt;device_management()-&gt;entries().size() == 2);</div><div class="line"></div><div class="line">   <span class="comment">// =============================================================================</span></div><div class="line">   <span class="comment">// Send alerts a specific device/unit.</span></div><div class="line">   <span class="comment">// =============================================================================</span></div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Send alerts to a specific device/unit ... &quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line"></div><div class="line">   <a class="code" href="structHF_1_1Protocol_1_1Address.html">HF::Protocol::Address</a> addr(2, 1);</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Send alert on ...&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   simple_detector.alert(addr, <span class="keyword">true</span>);</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Send alert off ... &quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   simple_detector.alert(addr, <span class="keyword">false</span>);</div></div><!-- fragment --></p>
<p>However having an hard coded address in a device is not very useful, as we would need to have a way to configure this address to make the device work well in any network is inserted into. For this purpose, packets can be sent to the broadcast address, being the responsibility of the concentrator to route them to the correct device.</p>
<p>In order to route a packet from one device/unit pair to another device/unit pair, for a given interface we need to create a binding rule on the concentrator.</p>
<p><div class="fragment"><div class="line">   <span class="comment">// Create a bind entry.</span></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Create bind entry on the base ... &quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   <a class="code" href="structHF_1_1Protocol_1_1Address.html">HF::Protocol::Address</a> source(1, 1);</div><div class="line">   <a class="code" href="structHF_1_1Protocol_1_1Address.html">HF::Protocol::Address</a> destination(2, 1);</div><div class="line">   <a class="code" href="structHF_1_1Common_1_1Interface.html">HF::Common::Interface</a> itf(<a class="code" href="structHF_1_1Interface.html#aa56692f4035b4541ea47538adfda3052a58de54764695af0c6991d2e81bdee136">HF::Interface::ALERT</a>, <a class="code" href="structHF_1_1Interface.html#a4e33516b1110eb20d58eeb686910e391a701b0e1a571b905a02ad4e1c8c3069b0">HF::Interface::CLIENT_ROLE</a>);</div><div class="line"></div><div class="line">   base.<a class="code" href="classHF_1_1Devices_1_1Concentrator_1_1Abstract.html#a2cb2098ad66f441fe4c9eb6a376007af">unit0</a>()-&gt;bind_management()-&gt;add(source, destination, itf);</div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;There should be one bind entry ... &quot;</span></div><div class="line">             &lt;&lt; base.<a class="code" href="classHF_1_1Devices_1_1Concentrator_1_1Abstract.html#a2cb2098ad66f441fe4c9eb6a376007af">unit0</a>()-&gt;bind_management()-&gt;entries().size() &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   assert(base.<a class="code" href="classHF_1_1Devices_1_1Concentrator_1_1Abstract.html#a2cb2098ad66f441fe4c9eb6a376007af">unit0</a>()-&gt;bind_management()-&gt;entries().size() == 1);</div></div><!-- fragment --></p>
<dl class="section note"><dt>Note</dt><dd>the interface parameter is that of the receiving the packet.</dd></dl>
<p>Now we can send the alert events to the broadcast address and they will be delivered to the correct device.</p>
<p><div class="fragment"><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Send alert on to the broadcast device/unit ... &quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   simple_detector.alert(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Send alert off to the broadcast device/unit ... &quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   simple_detector.alert(<span class="keyword">false</span>);</div><div class="line"></div><div class="line">   <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --></p>
<p><b>Full code listing</b></p>
 <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="hanfun_8h.html">hanfun.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="debug_8h.html">hanfun/debug.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="localloop_8h.html">localloop.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// =============================================================================</span></div><div class="line"><span class="comment">// Implementation</span></div><div class="line"><span class="comment">// =============================================================================</span></div><div class="line"></div><div class="line"><span class="keyword">namespace</span></div><div class="line">{</div><div class="line">   <span class="comment">/*</span></div><div class="line"><span class="comment">    * Unit implementing the Simple Detector profile.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">struct </span>SimpleDetector: <span class="keyword">public</span> <a class="code" href="classHF_1_1Units_1_1Unit.html">HF::Units::Unit</a>&lt;HF::Profiles::SimpleDetector&gt;</div><div class="line">   {</div><div class="line">      SimpleDetector(uint8_t <span class="keywordtype">id</span>, <a class="code" href="structHF_1_1IDevice.html">HF::IDevice</a> &amp;device):</div><div class="line">         <a class="code" href="namespaceHF.html">HF</a>::Units::Unit&lt;<a class="code" href="namespaceHF.html">HF</a>::Profiles::SimpleDetector&gt;(id, device)</div><div class="line">      {}</div><div class="line">   };</div><div class="line"></div><div class="line">   <span class="comment">/*</span></div><div class="line"><span class="comment">    * Unit implementing the Alertable profile, to receive alert events.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">struct </span>AlertSink: <span class="keyword">public</span> <a class="code" href="classHF_1_1Units_1_1Unit.html">HF::Units::Unit</a>&lt;HF::Profiles::Alertable&gt;</div><div class="line">   {</div><div class="line">      AlertSink(uint8_t <span class="keywordtype">id</span>, <a class="code" href="structHF_1_1IDevice.html">HF::IDevice</a> &amp;device):</div><div class="line">         <a class="code" href="namespaceHF.html">HF</a>::Units::Unit&lt;<a class="code" href="namespaceHF.html">HF</a>::Profiles::Alertable&gt;(id, device)</div><div class="line">      {}</div><div class="line"></div><div class="line">      <span class="keywordtype">void</span> status(<a class="code" href="structHF_1_1Protocol_1_1Address.html">HF::Protocol::Address</a> &amp;source, <a class="code" href="structHF_1_1Interfaces_1_1Alert_1_1Message.html">HF::Interfaces::Alert::Message</a> &amp;message)</div><div class="line">      {</div><div class="line">         <a class="code" href="classHF_1_1Units_1_1Unit.html">HF::Units::Unit&lt;HF::Profiles::Alertable&gt;::status</a>(source, message);</div><div class="line"></div><div class="line">         <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Alert received &quot;</span> &lt;&lt; std::hex &lt;&lt; std::showbase</div><div class="line">                   &lt;&lt; message.<a class="code" href="structHF_1_1Interfaces_1_1Alert_1_1Message.html#a5bc365bdb1cf890c31d53b2e6a36c44f">state</a> &lt;&lt; <span class="stringliteral">&quot; !&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">      }</div><div class="line">   };</div><div class="line"></div><div class="line">   <span class="comment">/*</span></div><div class="line"><span class="comment">    * Example node.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">struct </span>Node: <span class="keyword">public</span> <a class="code" href="classHF_1_1Devices_1_1Node_1_1Abstract.html">HF::Devices::Node::Node</a></div><div class="line">   {};</div><div class="line"></div><div class="line">   <span class="comment">/*</span></div><div class="line"><span class="comment">    * Example concentrator.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">struct </span><a class="code" href="structBase.html">Base</a>: <span class="keyword">public</span> <a class="code" href="classHF_1_1Devices_1_1Concentrator_1_1Abstract.html">HF::Devices::Concentrator::Concentrator</a></div><div class="line">   {};</div><div class="line"></div><div class="line">}  <span class="comment">// namespace</span></div><div class="line"></div><div class="line"><span class="comment">// =============================================================================</span></div><div class="line"><span class="comment">// MAIN</span></div><div class="line"><span class="comment">// =============================================================================</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div><div class="line">{</div><div class="line">   <a class="code" href="group__common.html#ga86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(argc);</div><div class="line">   <a class="code" href="group__common.html#ga86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(argv);</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Use case : Alert interface usage&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line"></div><div class="line">   <span class="comment">/*</span></div><div class="line"><span class="comment">    * Each node variable is a remote device, i.e.,</span></div><div class="line"><span class="comment">    * the Node variables are declared on the remote device</span></div><div class="line"><span class="comment">    * code and are not used on the base code.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Create the node instances ...&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line"></div><div class="line">   Node node1;</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Add unit to node1 instance ...&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   SimpleDetector simple_detector(1, node1);</div><div class="line"></div><div class="line">   Node node2;</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Add unit to node2 instance ...&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   AlertSink alert_sink(1, node2);</div><div class="line"></div><div class="line">   <span class="comment">/*</span></div><div class="line"><span class="comment">    * This instance represents the base application.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Create the base instance ...&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   <a class="code" href="structBase.html">Base</a> base;</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Create transport instance&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   Localloop loop;</div><div class="line"></div><div class="line">   <span class="comment">/*</span></div><div class="line"><span class="comment">    * Setup the network.</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * This simulates the devices connecting to the base using for</span></div><div class="line"><span class="comment">    * example a TCP/IP connection or a DECT ULE PVC.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Network setup ...&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line"></div><div class="line">   loop.set_base(&amp;base);</div><div class="line">   loop.add_node(&amp;node1, <span class="stringliteral">&quot;node_1&quot;</span>);</div><div class="line">   loop.add_node(&amp;node2, <span class="stringliteral">&quot;node_2&quot;</span>);</div><div class="line"></div><div class="line">   <span class="comment">// Register the two devices.</span></div><div class="line"></div><div class="line">   <span class="comment">// Node 1 is unregistered.</span></div><div class="line">   assert(node1.address() == <a class="code" href="group__protocol.html#ga23f7a5fde66435071c5d332e9d3dbf0f">HF::Protocol::BROADCAST_ADDR</a>);</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Registering node1 ... &quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   node1.unit0()-&gt;device_management()-&gt;register_device();</div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Node1 address ... &quot;</span> &lt;&lt; node1.address() &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line"></div><div class="line">   <span class="comment">// Node 1 is registered</span></div><div class="line">   assert(node1.address() == 1);</div><div class="line"></div><div class="line">   <span class="comment">// Node 2 is unregistered.</span></div><div class="line">   assert(node2.address() == <a class="code" href="group__protocol.html#ga23f7a5fde66435071c5d332e9d3dbf0f">HF::Protocol::BROADCAST_ADDR</a>);</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Registering node2 ... &quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   node2.unit0()-&gt;device_management()-&gt;register_device();</div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Node2 address ... &quot;</span> &lt;&lt; node2.address() &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line"></div><div class="line">   <span class="comment">// Node 2 is registered</span></div><div class="line">   assert(node2.address() == 2);</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;There should be two registered devices ... &quot;</span></div><div class="line">             &lt;&lt; base.<a class="code" href="classHF_1_1Devices_1_1Concentrator_1_1Abstract.html#a2cb2098ad66f441fe4c9eb6a376007af">unit0</a>()-&gt;device_management()-&gt;entries().size() &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line"></div><div class="line">   assert(base.<a class="code" href="classHF_1_1Devices_1_1Concentrator_1_1Abstract.html#a2cb2098ad66f441fe4c9eb6a376007af">unit0</a>()-&gt;device_management()-&gt;entries().size() == 2);</div><div class="line"></div><div class="line">   <span class="comment">// =============================================================================</span></div><div class="line">   <span class="comment">// Send alerts a specific device/unit.</span></div><div class="line">   <span class="comment">// =============================================================================</span></div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Send alerts to a specific device/unit ... &quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line"></div><div class="line">   <a class="code" href="structHF_1_1Protocol_1_1Address.html">HF::Protocol::Address</a> addr(2, 1);</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Send alert on ...&quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   simple_detector.alert(addr, <span class="keyword">true</span>);</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Send alert off ... &quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   simple_detector.alert(addr, <span class="keyword">false</span>);</div><div class="line"></div><div class="line">   <span class="comment">// =============================================================================</span></div><div class="line">   <span class="comment">// Send alerts to the broadcast device/unit.</span></div><div class="line">   <span class="comment">// =============================================================================</span></div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Send alerts to the broadcast device/unit ... &quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line"></div><div class="line">   <span class="comment">// Create a bind entry.</span></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Create bind entry on the base ... &quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   <a class="code" href="structHF_1_1Protocol_1_1Address.html">HF::Protocol::Address</a> source(1, 1);</div><div class="line">   <a class="code" href="structHF_1_1Protocol_1_1Address.html">HF::Protocol::Address</a> destination(2, 1);</div><div class="line">   <a class="code" href="structHF_1_1Common_1_1Interface.html">HF::Common::Interface</a> itf(<a class="code" href="structHF_1_1Interface.html#aa56692f4035b4541ea47538adfda3052a58de54764695af0c6991d2e81bdee136">HF::Interface::ALERT</a>, <a class="code" href="structHF_1_1Interface.html#a4e33516b1110eb20d58eeb686910e391a701b0e1a571b905a02ad4e1c8c3069b0">HF::Interface::CLIENT_ROLE</a>);</div><div class="line"></div><div class="line">   base.<a class="code" href="classHF_1_1Devices_1_1Concentrator_1_1Abstract.html#a2cb2098ad66f441fe4c9eb6a376007af">unit0</a>()-&gt;bind_management()-&gt;add(source, destination, itf);</div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;There should be one bind entry ... &quot;</span></div><div class="line">             &lt;&lt; base.<a class="code" href="classHF_1_1Devices_1_1Concentrator_1_1Abstract.html#a2cb2098ad66f441fe4c9eb6a376007af">unit0</a>()-&gt;bind_management()-&gt;entries().size() &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   assert(base.<a class="code" href="classHF_1_1Devices_1_1Concentrator_1_1Abstract.html#a2cb2098ad66f441fe4c9eb6a376007af">unit0</a>()-&gt;bind_management()-&gt;entries().size() == 1);</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Send alert on to the broadcast device/unit ... &quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   simple_detector.alert(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">   <a class="code" href="group__debug.html#gadadcbb9e426e1bf6bd7ac06dac7f958b">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Send alert off to the broadcast device/unit ... &quot;</span> &lt;&lt; <a class="code" href="group__debug.html#ga4fc34b120ed3bd1120c1eb36abbcd6af">NL</a>;</div><div class="line">   simple_detector.alert(<span class="keyword">false</span>);</div><div class="line"></div><div class="line">   <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="tutorials.html">Getting Started</a></li>
    <li class="footer">Generated on Fri Mar 2 2018 11:03:36 for HAN-FUN API by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
